# 알림톡 대체 문자 메시지 v1.0.0

1. [개요](#1-개요)
2. [Webhook](#2-Webhook)
3. [코드 정의](#3-코드-정의)

## 참고 : 변경사항

| 일시       | 변경 내역                                                                                                                                                                                                                |
| ---------- | -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2024.09.    | 알림톡 대체 문자 메시지 초안 작성        

## 1. 개요

+ 한국 휴대폰 번호로만 메시지 전송이 가능하며, 장문 메시지를 보낼 경우 메시지 길이가 90byte 를 초과하는 경우 LMS로 발송 됩니다.
+ 문자 메시지 발송 결과 코드는 Webhook을 통해서만 받을 수 있으며, 문자 메시지 특성 상 최대 3일 이내 응답을 받을 수 있습니다.
+ 개발 환경은 실제 문자 메시지를 받아 볼 수 없으며, Webhook을 통해 처리 결과 코드를 확인 할 수 있습니다.
+ 알림톡 발송이 실패 할 경우, 설정된 대체 문자 메시지로 발송 처리 됩니다.
+ 대체 문자 메시지(message) 내 광고성 정보가 포함될 수 없으며, 광고성 메시지 발송으로 인한 법적 문제는 전송자에게 있습니다.
+ 모든 문자 길이는 `EUC-KR` 인코딩 기준 입니다.

## 2. Webhook
> 루나소프트 운영 담당자를 통해 `Webhook URL`을 사전에 등록해야 함.
- path : `사전에 등록된 Webhook URL`
- method : `POST`
- header :
  - Content-Type : application/json
- body :

```json
{
  "code": "text",  
  "message_key": "text",
  "message_type": "text",
  "response_dt": "text"
}
```

| 키 | 타입 | 필수 | 설명 | 예제 |
| ------ | ------ | ------ | ------ | ------ |
| code | text(6) | Y | 처리 결과 코드<br/>(1000은 정상 / 나머지는 오류) | "code ":"1000" **[<3.1 오류코드 에서 확인 가능>](#31-오류-코드)**|
| message_key | text(27) | N | 메시지 일련번호 (요청 시 설정한 메시지 일련번호) | "message_key":"605498276" |
| message_type | text(3) | Y | 메시지 타입<br/>(SMS, LMS) | "message_type":"LMS" |
| response_dt | datetime | Y | 메시지 발송 응답 시간 | 2024-03-22 09:05:30 |

- 발송 성공 Sample
```json
{
  "code": "1000",  
  "message_key": "605498276",
  "message_type": "LMS",
  "response_dt": "2024-03-22 09:05:30"
}
```

- 발송 실패 Sample
```json
{
  "code": "3000",  
  "message_key": "605498276",
  "message_type": "LMS",
  "response_dt": "2024-03-22 09:05:30"
}
```

## 3. 코드 정의
### 3.1 오류 코드

| code    | 설명                                                                                                                       |
| ------- | ------------------------------------------------------------------------------------------------------------------------------|
| 1000    | 성공 : 단말기에 메시지 정상 도착                                                                                                |
| 2000    | 전송 시간 초과                                                                                                                 |
| 2001    | 전송 실패 (무선망단)                                                                                                           |
| 2002    | 전송 실패 (무선망 -> 단말기단)                                                                                                  |
| 2003    | 단말기 전원 꺼짐                                                                                                               |
| 2004    | 단말기 메시지 버퍼 풀                                                                                                          |
| 2005    | 음영지역                                                                                                                      |
| 2006    | 메시지 삭제됨                                                                                                                  |
| 2007    | 일시적인 단말 문제                                                                                                             |
| 3000    | 전송할 수 없음                                                                                                                 |
| 3001    | 가입자 없음                                                                                                                    |
| 3002    | 성인 인증 실패                                                                                                                 |
| 3003    | 수신번호 형식 오류                                                                                                             |
| 3004    | 단말기 서비스 일시 정지                                                                                                        |
| 3005    | 단말기 호 처리 상태                                                                                                            |
| 3006    | 착신 거절                                                                                                                     |
| 3008    | 기타 단말기 문제                                                                                                               |
| 3009    | 메시지 형식 오류                                                                                                               |
| 3010    | MMS 미지원 단말                                                                                                               |
| 3011    | 서버 오류                                                                                                                     |
| 3012    | 스팸                                                                                                                          |
| 3013    | 서비스 거부                                                                                                                   |
| 3014    | 기타                                                                                                                          |
| 3015    | 전송 경로 없음                                                                                                                 |
| 3016    | 첨부파일 사이즈 제한 실패<br/>-발신번호 변작 방지 세칙 위반<br/>-동보 메시지 전송 시 일부 건 세칙 위반                               |
| 3018    | 휴대폰 가입 이동통신사를 통해 발신번호 변작 방지 부가 서비스에 가입된 번호를 발신번호로 사용하는 경우                                |
| 3019    | KISA or 미래부에서 모든 고객사에 대하여 차단 처리 요청된 번호를 발신번호로 사용하는 경우                                            |
| 3025    | 24 시간 이내 중복 발송                                                                                                         |
| 9102 ~ 9200    | 루나 발송 파이프라인 시스템 오류로 메시지 전송 실패 (루나 시스템)                                                           |
| A100    | 인증 실패                                                                                                                     |
| A110    | 만료된 토큰                                                                                                                   |
| A111    | 토큰 권한 없음                                                                                                                |
| A200    | 잘못된 인증정보                                                                                                                |
| A210    | 차단된 계정                                                                                                                   |
| A211    | 차단된 계정                                                                                                                   |
| A212    | 인증 실패 횟수 초과 (10 회)                                                                                                    |
| A300    | Client ID 없음                                                                                                               |
| A301    | 발신자 번호 형식 오류                                                                                                          |
| A302    | 메시지 형식 오류                                                                                                              |
| A303    | 유효하지 않은 TTL                                                                                                             |
| A304    | REF 형식 오류                                                                                                                |
| A305    | PAYMENTCODE 형식 오류                                                                                                         |
| A306    | CLIENT SUB ID 형식 오류                                                                                                       |
| A307    | 수신번호 없음                                                                                                                 |
| A308    | 발송 가능한 수신번호 수(200건) 초과                                                                                            |
| A309    | 잘못된 요청                                                                                                                   |
| A310    | 첨부 가능한 파일 키 수(3 건) 초과                                                                                              |
| A311    | 유효하지 않는 전송 시간                                                                                                       |
| A500    | 유효하지 않은 Group ID                                                                                                       |
| A501    | 유효하지 않은 Message ID                                                                                                     |
| A506    | 리포트 Pull API 사용권한 없음                                                                                                 |
| A507    | 조회 기간 초과 또는 유효하지 않은 호출                                                                                         |
| A508    | 리포트 Pull API 분당 호출 건수 초과                                                                                           |
| A900    | 서비스 점검                                                                                                                  |
| A999    | 알려지지 않은 에러                                                                                                            |
| M004    | 발신자 번호 형식 오류                                                                                                         |
| M005    | 메시지 형식 오류                                                                                                             |
| M006    | 유효하지 않은 TTL                                                                                                            |
| M008    | 스팸 필터링                                                                                                                  |
| M010    | 등록되지 않은 발신번호                                                                                                        |
| M011    | 발신번호 변작 방지 기준 위반 발신번호                                                                                          |
| M014    | 이미지 파일 처리 실패                                                                                                         |
| M015    | 유효하지 않은 이미지 파일 키                                                                                                  |
| M016    | 유효하지 않는 전송 시간                                                                                                       |
| M017    | 24 시간 이내 중복 발송                                                                                                       |
| M101    | 메시지 형식 오류                                                                                                             |
| M999    | 알려지지 않은 에러                                                                                                           |
| R001    | 일시적 서비스 장애                                                                                                           |
| R002    | 인증 실패                                                                                                                    |
| R003    | 수신번호 형식 오류                                                                                                           |
| R007    | 유효하지 않은 파라미터 오류                                                                                                   |
| R009    | 서버 capacity 초과, 재시도 요망                                                                                              |
| R012    | 해당 서비스 유형 전송 권한 없음                                                                                               |
| R013    | 발송 가능 건수 초과                                                                                                          |
| R102    | 유효하지 않은 수신번호                                                                                                       |
| R103    | 네트워크 에러                                                                                                               |
| R104    | 유효하지 않는 전송 시간                                                                                                      |
| R999    | 알려지지 않은 에러                                                                                                           |

